<!DOCTYPE html>
<html>
  <head lang="en">
      <meta charset="UTF-8">
      <title>Online Store Application</title>
  </head>
  <script src="js/DataController.js"></script>
  <script src="js/init.js"></script>	
  <link rel="stylesheet" type="text/css" href="css/main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <body>
    <ul>
      <li><a href="#profile">Profile</a></li>
      <li><a href="#items" onclick="load_js()">Items</a></li>
      <li><a href="#cart">Cart</a></li>
    </ul>
    <div id="app">

    </div>
    <script src="js/login.js"></script>
    <script src="js/cart.js"></script>
    <script src="js/route.js"></script>
    <script src="js/router.js"></script>
    <script src="js/app.js"></script>
    <script src="js/init.js"></script>
  </body>
  <script>
    var user = null;
    var userFname = null;
    var userLname = null;
    var userEmail = null;
    addedSignoutListener = true;
    addedSigninListener = true;
    function load_js()
   {

      var head= document.getElementsByTagName('head')[0];
      var script= document.createElement('script');
      script.src= 'js/init1.js';
      head.appendChild(script);
   }

    function load_js_login() {
        var head= document.getElementsByTagName('head')[0];
        var script= document.createElement('script');
        script.src= 'js/login.js';
        script.id = 'loginScript';
        head.appendChild(script);
     }

     function load_js_cart() {
        var head= document.getElementsByTagName('head')[0];
        var script= document.createElement('script');
        script.src= 'js/cart.js';
        script.id = 'cartScript';
        head.appendChild(script);
     }
     function showButtons() {
         console.log("show buttons")
         console.log("user", user);
         addedSignoutListener = true;
         addedSigninListener = true;
         var buttons = document.getElementsByName("spanButtons");

         //Default login form is visible first
         document.getElementById("register").style.display = "none"; 
         document.getElementById("login").style.display = "block"; 

        //Make the radio buttons visible
         buttons.forEach(button => {
             button.style.display = "block";
         });
         document.getElementById('showButton').style.display = "none";
         document.getElementById('loginform').style.display = "block";
        var signoutButton = document.getElementById('signout');
        signoutButton.addEventListener("click", () => signout());
     }

     function signout () {
        console.log("in signout of index");
        user = null;
        var userFname = null;
        var userLname = null;
        var userEmail = null;
        location.reload();
       
    }

    function walmartPopulate(form) {
      console.log("In walmart populate");
      console.log(form.childNodes[1].value);

      let apiKey = "smz7vjqbgccrek7sh7e2bu74";

      let urlBase = "https://api.walmartlabs.com/v1/search?query=";

      let url = urlBase + form.childNodes[1].value + "&format=json&apiKey=" + apiKey;
      console.log("url", url);

      //http://api.walmartlabs.com/v1/search?query=shirt&format=json&apiKey=your API_key

     

      /**Define what to do with the album titles list **/
      var populateItemListTile = function (items){
        //console.log("items", items);
        var itemDiv = document.getElementById("itemList");
        if(itemDiv != null)
        {
          var titleProp = "title";
          if(items.items != null){
            items = items.items.item;
            titleProp = "name";
          }

          /**Clear existing views **/
          removeChildNodes(document.getElementById("itemDetails"));
          removeChildNodes(itemDiv);

          //Create tiles for every item in the item array
          items.forEach(function(item){
            /**Define the item "tile" **/	
            //console.log("debug:", item.name);	
            //console.log("debug item:", item);
            var tileNode = createTileNode(item.shortDescription, "item", item);

            itemDiv.appendChild(tileNode);
          });
        }
        
      }

      var populateItemListTable = function (items){
        var itemDiv = document.getElementById("itemList");

        if(itemDiv != null) {
        
          /**Clear existing views **/
          removeChildNodes(document.getElementById("itemDetails"));
          removeChildNodes(itemDiv);

          var table = document.createElement("table"); 
          table.classList.add('itemTable');
          var header = table.createTHead();
          var row = header.insertRow(0);
          var cell = row.insertCell(0);
          cell.innerHTML = "<b>Item</b>";
          var cell2 = row.insertCell(1);
          cell2.innerHTML = "<b>Description</b>";

          let i = 1;
          //Create table rows for every item in the item array
          items.forEach(function(item){
            var row = table.insertRow(i++);
            var name = row.insertCell(0);
            var description = row.insertCell(1);
            name.innerHTML = item.name;
            description.innerHTML = item.shortDescription;
            
          }); 

          itemDiv.appendChild(table);
        }

      }

      var createTileNode = function(title, classType, item){
        let itemClass = item.name.split(" ");
        var tileNode = document.createElement("div");
        var titleNode = document.createTextNode(title);
        var itemNode = document.createElement("div");
        itemNode.className = itemClass[1]+"Icon";
        tileNode.className = classType+"TileDiv";
        tileNode.appendChild(itemNode);
        tileNode.appendChild(titleNode);
        return tileNode;
      }

      var createPropTextNode = function(str){
        var detailDiv = document.getElementById("itemDetails");
        var propNode = document.createElement("div");
        var textNode = document.createTextNode(str);
        propNode.appendChild(textNode);
        detailDiv.appendChild(propNode);					
      }

      /**Set event listener for radio buttons**/
      var apiRadioButtons = document.getElementsByName("api");
      apiRadioButtons.forEach(function(button){
        button.addEventListener("click", function(){
          var value = button.value;
          if (value === "tile") {
            //use tile view
            console.log("Tile fill!");
            //reloadPage();
            makeRequest(populateItemListTile);

          }
          else { // use table view
            //dc.isLocalApi = false;
            console.log("Table fill!");
            //reloadPage();
            makeRequest(populateItemListTable);
          }
          
          

        });
        
      });

      var removeChildNodes = function(parentDiv){
        if(parentDiv != null)
        {
          while (parentDiv.hasChildNodes()) {
            parentDiv.removeChild(parentDiv.firstChild);
          }
        }
        
      }

      var makeRequest = function(url, callBackFunction) {
        console.log("Making request");
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            //console.log("txt",this.responseText);
            var jsonData = JSON.parse(this.responseText);
            console.log(jsonData);
            console.log(jsonData.items);
            if(callBackFunction != null){
              console.log("jsonData", jsonData.items);
              callBackFunction(jsonData.items);
            } 
          }
        };
    
        xhttp.open("GET", url, true);
        xhttp.setRequestHeader('Access-Control-Allow-Headers', '*');
        xhttp.setRequestHeader('Content-type', 'application/ecmascript');
        xhttp.setRequestHeader('Access-Control-Allow-Origin', '*');
        xhttp.send();
      }

       makeRequest(url, populateItemListTile);

     
      
    }

   
   load_js();

  
  </script>
</html>
